# ~/.zsh_scriptlets
# Small scripts to make my life easier

function please() {
  # grab the previous command
  local last_cmd
  last_cmd=$(fc -ln -1)

  # let ‚Äôem know what‚Äôs up
  echo "üôè sudo $last_cmd"

  # actually run it
  eval "sudo $last_cmd"
}

theme() {
  if [[ -z "$1" ]]; then
    echo "Usage: omp-theme <theme>"
    return 1
  fi

  local newtheme="$1"
  local dir="$HOME/.oh-my-posh/themes"
  local json="$dir/${newtheme}.omp.json"
  local yaml="$dir/${newtheme}.omp.yaml"
  local config

  if [[ -f "$json" ]]; then
    config="$json"
  elif [[ -f "$yaml" ]]; then
    config="$yaml"
  else
    echo "No theme file found for '${newtheme}' (tried .json and .yaml)."
    return 1
  fi

  # persist theme to file
  echo "$newtheme" > ~/.omp_current
  # current session
  export OMPTHEME="${newtheme}"
  # re-init with whichever file we found
  eval "$(oh-my-posh init zsh --config "$config")"

  echo "OMP theme switched to ${newtheme} ($(basename "$config"))."
}

function mkcd() {
  mkdir -p -- "$1" && cd -P -- "$1"
}

function copypath() {
  if [[ -z "$1" ]]; then
    return 1
  fi

  realpath $1 | clip.exe
}

themes () {
  local selection
  local -a files names

  files=(~/.oh-my-posh/themes/*.omp.(json|yaml)(N))
  names=(${files:t:r:r})   # :t = basename, :r removes one extension; twice removes .omp and .json/.yaml

  selection=$(print -l -- ${(ou)names} | fzf --height=50% --reverse --prompt="Select theme ‚ñ∂ ")
  if [[ -n $selection ]]; then
    theme "$selection"
  else
    echo "No theme selected, nothing changed."
  fi
}

